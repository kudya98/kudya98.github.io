(this["webpackJsonpthreejs-singleplayer-game"]=this["webpackJsonpthreejs-singleplayer-game"]||[]).push([[0],{15:function(t,e,i){t.exports=i(24)},22:function(t,e,i){},23:function(t,e,i){},24:function(t,e,i){"use strict";i.r(e);var n=i(2),o=i.n(n),a=i(12),s=i.n(a),r=i(9),u=i(0),c=i(8),h=i(1),d=i(3),l=i(5),p=i(4),f=i(7),m=i(6),v=i(10),b=i(13),y=function(){function t(e){var i=this;Object(h.a)(this,t),this.mixer=void 0,this.list=void 0,this.clips=void 0,this.current=void 0,this.mixer=new u.d(e.model),this.clips=e.model.animations,this.list=[],this.current=[],this.clips.forEach((function(t){var e=i.mixer.clipAction(t),n=0,o=function(t){return!1};switch(t.name){case"idle":n=1,o=function(t){return 0===t.dX&&0===t.dZ};break;case"walkbackward":n=3,o=function(t){return(0!==t.dX||0!==t.dZ)&&Math.pow(t.dX,2)+Math.pow(t.dZ,2)<Math.pow(t.speed,2)-10};break;case"walkforward":n=3,o=function(t){return Math.pow(t.dX,2)+Math.pow(t.dZ,2)>=Math.pow(t.speed,2)-10};break;case"shoot":e.setLoop(u.y,1),e.clampWhenFinished=!0,n=2,o=function(t){var e;return"shoot"===(null===(e=t.currentAction)||void 0===e?void 0:e.name)};break;case"run":n=4,o=function(t){var e;return"run"===(null===(e=t.currentAction)||void 0===e?void 0:e.name)};break;case"hit":e.setLoop(u.y,1),e.timeScale=3,n=5,o=function(){return!1};break;case"attack":e.setLoop(u.y,1),n=5,o=function(t){var e;return"attack"===(null===(e=t.currentAction)||void 0===e?void 0:e.name)};break;case"dying":e.setLoop(u.y,1),e.clampWhenFinished=!0,n=6,o=function(t){return t.hp<=0};break;default:return}i.list.push(Object.assign(e,{priority:n,name:t.name,isActive:o}))}))}return Object(d.a)(t,[{key:"play",value:function(t){var e=this,i=this.list.sort((function(e,i){return i.isActive(t)!=e.isActive(t)?+i.isActive(t)-+e.isActive(t):i.priority-e.priority})),n=i.filter((function(e){return e.priority===i[0].priority&&e.isActive(t)}));n.forEach((function(t){return!e.current.includes(t)&&t.play()})),this.current.forEach((function(t){return!n.includes(t)&&t.stop()})),this.current=n}}]),t}(),w=5e3,g=function(){function t(e){Object(h.a)(this,t),this.maxHp=void 0,this.hp=void 0,this.speed=void 0,this.position=void 0,this.actions=[],this.model=void 0,this.currentAction=void 0,this.quadtreeIndex=void 0,this.rotationAngle=0,this.size=50,this.dX=0,this.dZ=0,this.animations=void 0,this.hpRegen=void 0,this.hitBox=void 0,this.world=void 0,this.tickTimestamp=void 0,this.timeout=void 0,this.world=K.getInstance(),this.model=e,this.position=e.position,this.animations=new y(this),this.world.add(this)}return Object(d.a)(t,[{key:"update",value:function(t,e,i,n){var o=this;if(this.tickTimestamp=performance.now(),this.hp<=0)return this.animations.play(this),this.animations.mixer.update(t/1e3),this.hitBox&&(this.model.remove(this.hitBox),this.hitBox=void 0),void(this.timeout||(this.timeout=setTimeout((function(){o.world.remove(o)}),w)));var a=Number((this.hp+this.hpRegen*(t/1e3)).toFixed(2));a>this.maxHp&&(a=this.maxHp),this.hitBox&&this.hitBox.update(a),this.hp=a,this.animations.mixer.update(t/1e3),this.actionHandler(t,i,n),this.detectCollisions(e),this.updateActions(t),this.animations.play(this);var s={x:this.position.x+this.dX*(t/1e3),z:this.position.z+this.dZ*(t/1e3)};Math.abs(s.x)<this.world.size/2&&Math.abs(s.z)<this.world.size/2&&(this.position.x=s.x,this.position.z=s.z),this.model.rotation.set(0,this.rotationAngle,0)}},{key:"detectCollisions",value:function(e){var i=this,n=e.filter((function(t){return i!==t&&Math.pow(t.position.x-i.position.x,2)+Math.pow(t.position.z-i.position.z,2)<Math.pow(i.size,2)+Math.pow(t.size,2)}));n.length&&n.forEach((function(e){t.handleCollision(i,e)}))}}],[{key:"handleCollision",value:function(t,e){var i=e.position.x-t.position.x,n=e.position.z-t.position.z,o=Math.sqrt(i*i+n*n);if(t.size+e.size>=o){var a=i/o,s=n/o,r=o*(t.size/(t.size+e.size)),u=t.position.x+a*r,c=t.position.z+s*r;t.position.x=u-a*t.size,t.position.z=c-s*t.size,e.position.x=u+a*e.size,e.position.z=c+s*e.size}}}]),t}();function x(t){return t.match(/(\w+)\.fbx/)?t.match(/(\w+)\.fbx/)[1]:t}var j=function(){function t(e){var i=this;Object(h.a)(this,t),this.name=void 0,this.start=void 0,this.complete=void 0,this.stop=void 0,this.passedArgs=void 0,this.onComplete=0,this.duration=void 0;var n=e.name,o=e.unit,a=e.onStart,s=e.onStop,r=e.onComplete;this.name=n,e.duration?this.duration=e.duration:this.duration=1/0,this.start=function(){if(o.currentAction){if(o.currentAction===i||o.currentAction.duration===1/0)return!1;o.currentAction.stop()}for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!!a.apply(void 0,e)&&(o.currentAction=i,i.onComplete=i.duration,i.passedArgs=e,!0)},this.stop=function(){s(),i.onComplete=0,i.passedArgs=[],o.currentAction=void 0},this.complete=function(){r.apply(void 0,Object(c.a)(i.passedArgs)),i.onComplete=0,i.passedArgs=[],o.currentAction=void 0}}return Object(d.a)(t,[{key:"update",value:function(t){this.isActive()&&this.onComplete!==1/0&&(this.onComplete-=t,this.isActive()||this.complete())}},{key:"isActive",value:function(){return this.onComplete>0}}]),t}(),k=function t(){Object(h.a)(this,t),this.actions=void 0,this.name=void 0,this.bullets=void 0,this.maxBullets=void 0};function O(t,e){return t[0]*e[0]+t[1]*e[1]}var z=2e3,E=function(t){function e(t,i,n,o,a){var s;return Object(h.a)(this,e),(s=Object(l.a)(this,Object(p.a)(e).call(this,t,i))).quadtreeIndex=void 0,s.world=void 0,s.dX=void 0,s.dZ=void 0,s.rotationAngle=void 0,s.owner=void 0,s.destroyTimeout=z,s.owner=n,s.world=K.getInstance(),s.position.y=n.position.y+150,s.position.x=n.position.x+n.size*o.x,s.position.z=n.position.z+n.size*o.y,s.rotationAngle=Math.atan2(o.y,o.x)-Math.PI/2,s.rotateX(Math.PI/2),s.rotateZ(s.rotationAngle),s.dX=a.speed*o.x,s.dZ=a.speed*o.y,s.world.add(Object(f.a)(s)),s}return Object(m.a)(e,t),Object(d.a)(e,[{key:"detectCollisions",value:function(t,e,i){var n=this;return t.filter((function(t){return n.owner!==t&&function(t,e,i,n,o,a,s){var r=[o-t,a-e],u=[i-t,n-e],c=O(u,u),h=O(r,u)/c,d=[u[0]*(h=(h=h<0?0:h)>1?1:h)+t-o,u[1]*h+e-a];return O(d,d)<=s*s}(n.position.x,n.position.z,e,i,t.position.x,t.position.z,t.size)}))}}]),e}(u.C),M=200,A=function(t){function e(t,i,n){var o;Object(h.a)(this,e);var a=K.getInstance(),s=document.getElementById("vertexShader").textContent||void 0,r=document.getElementById("fragmentShader").textContent||void 0,c=new u.l(5,5,100),d=new u.D({color:16777215});o=Object(l.a)(this,Object(p.a)(e).call(this,c,d,t,i,n));var f=new u.l(7,7,125),m=new u.R({uniforms:{c:{type:"f",value:1},p:{type:"f",value:1.2},glowColor:{type:"c",value:new u.j(255)},viewVector:{type:"v3",value:a.camera.position}},vertexShader:s,fragmentShader:r,side:u.r,blending:u.a,transparent:!0}),v=new u.C(f,m);return o.add(v),o}return Object(m.a)(e,t),Object(d.a)(e,[{key:"update",value:function(t,e){if(this.destroyTimeout<=0)this.world.remove(this);else{this.destroyTimeout-=t;var i=this.position.x+this.dX*(t/1e3),n=this.position.z+this.dZ*(t/1e3),o=this.detectCollisions(e,i,n);this.handleCollisions(o),this.position.x=i,this.position.z=n}}},{key:"handleCollisions",value:function(t){var e=this;t.length&&(t.forEach((function(t){t.hp-=M,t.position.x+=.001*e.dX,t.position.z+=.001*e.dZ;var i=t.animations.list.find((function(t){return"hit"===t.name}));i&&(i.reset(),i.play())})),this.world.remove(this))}}]),e}(E),S=function(){function t(e){var i=this;Object(h.a)(this,t),this.src={},e.forEach((function(t){var e=t.name||t.url.match(/(\w+)\.wav|mp3/)[1];i.src[e]=new Audio(t.url)}))}return Object(d.a)(t,[{key:"play",value:function(t){this.src[t]&&(this.src[t].volume=K.SOUNDS_LEVEL,this.src[t].play())}},{key:"pause",value:function(t){this.src[t]&&this.src[t].pause()}},{key:"load",value:function(t){this.src[t]&&this.src[t].load()}},{key:"reinit",value:function(t){var e=t.name||t.url.match(/(\w+)\.wav|mp3/)[1];this.src[e]=new Audio(t.url)}},{key:"clear",value:function(t){this.src[t]&&delete this.src[t]}}]),t}(),C={bullets:30,firerate:12,bulletSpeed:4e3,reloadDuration:2300,accuracy:1},L=function(t){function e(t){var i;Object(h.a)(this,e),(i=Object(l.a)(this,Object(p.a)(e).call(this))).name=void 0,i.actions=void 0,i.bullets=void 0,i.maxBullets=void 0,i.sounds=void 0;var n=1e3/C.firerate,o=t.animations.list.find((function(t){return"shoot"===t.name}));return o&&o.setDuration(n/1e3),i.name="Rifle",i.sounds=new S([{url:"sounds/rifle/shoot.wav"},{url:"sounds/rifle/reload.wav"},{url:"sounds/rifle/foley.wav"}]),i.bullets=i.maxBullets=C.bullets,i.actions=[new j({name:"shoot",duration:n,unit:t,onStart:function(e){if(i.bullets>0){i.sounds.play("shoot"),i.sounds.reinit({url:"sounds/rifle/shoot.wav"}),i.bullets--;var n=e.clone().rotateAround(new u.ab(0,0),(Math.random()-.5)*(1-C.accuracy));return new A(t,n,{speed:C.bulletSpeed}),!0}return i.sounds.play("foley"),i.sounds.clear("foley"),!1},onStop:function(){},onComplete:function(){}}),new j({name:"reload",duration:C.reloadDuration,unit:t,onStart:function(){return i.bullets<i.maxBullets&&(i.sounds.load("reload"),i.sounds.play("reload"),!0)},onStop:function(){i.sounds.pause("reload")},onComplete:function(){i.bullets=i.maxBullets,i.sounds.reinit({url:"sounds/rifle/foley.wav"}),i.sounds.pause("reload")}})],i}return Object(m.a)(e,t),e}(k),P=40,D=function(t){function e(t,i,n){Object(h.a)(this,e);var o=new u.V(5,128,128),a=new u.D({color:16777215});return Object(l.a)(this,Object(p.a)(e).call(this,o,a,t,i,n))}return Object(m.a)(e,t),Object(d.a)(e,[{key:"update",value:function(t,e){if(this.destroyTimeout<=0)this.world.remove(this);else{this.destroyTimeout-=t;var i=this.position.x+this.dX*(t/1e3),n=this.position.z+this.dZ*(t/1e3),o=this.detectCollisions(e,i,n);this.handleCollisions(o),this.position.x=i,this.position.z=n}}},{key:"handleCollisions",value:function(t){var e=this;t.length&&t.forEach((function(t){t.hp-=P,t.position.x+=.002*e.dX,t.position.z+=.002*e.dZ;var i=t.animations.list.find((function(t){return"hit"===t.name}));i&&(i.reset(),i.play()),e.world.remove(e)}))}}]),e}(E),I={bullets:7,firerate:2,bulletSpeed:1200,reloadDuration:500},R=function(t){function e(t){var i;Object(h.a)(this,e),(i=Object(l.a)(this,Object(p.a)(e).call(this))).name=void 0,i.actions=void 0,i.bullets=void 0,i.maxBullets=void 0,i.sounds=void 0;var n=1e3/I.firerate,o=t.animations.list.find((function(t){return"shoot"===t.name}));return o&&o.setDuration(n/1e3),i.name="Shotgun",i.sounds=new S([{url:"sounds/shotgun/shoot.wav"},{url:"sounds/shotgun/reload.wav"}]),i.bullets=i.maxBullets=I.bullets,i.actions=[new j({name:"shoot",duration:n,unit:t,onStart:function(e){if(i.bullets>0){i.sounds.play("shoot"),i.sounds.reinit({url:"sounds/shotgun/shoot.wav"}),i.bullets--;for(var n=-8;n<9;n++){var o=e.clone().rotateAround(new u.ab(0,0),.3*(Math.random()-.5));new D(t,o,{speed:I.bulletSpeed*(1+.1*Math.random())})}return!0}return!1},onStop:function(){},onComplete:function(){}}),new j({name:"reload",duration:I.reloadDuration,unit:t,onStart:function(){return i.bullets<i.maxBullets&&(i.sounds.load("reload"),i.sounds.play("reload"),!0)},onStop:function(){i.sounds.pause("reload")},onComplete:function(){i.sounds.pause("reload"),i.bullets++}})],i}return Object(m.a)(e,t),e}(k),Z={energy:100,hp:1e3,energyRegen:10,hpRegen:50,speed:400,runSpeed:800,runCost:30},B=function(t){function e(t,i,n){var o;return Object(h.a)(this,e),(o=Object(l.a)(this,Object(p.a)(e).call(this,t))).energy=void 0,o.maxEnergy=void 0,o.weapons=[],o.currentWeapon=void 0,o.maxHp=Z.hp,o.hp=Z.hp,o.speed=Z.speed,o.hpRegen=Z.hpRegen,o.keyMap={},o.energyRegen=void 0,o.energy=o.maxEnergy=Z.energy,o.energyRegen=Z.energyRegen,o.position.x=i,o.position.z=n,o.weapons=[new L(Object(f.a)(o)),new R(Object(f.a)(o))],o.currentWeapon=o.weapons[0],o.actions=[new j({name:"run",unit:Object(f.a)(o),onStart:function(){return o.speed=Z.runSpeed,o.energyRegen-=Z.runCost,!0},onStop:function(){o.energyRegen+=Z.runCost,o.speed=Z.speed},onComplete:function(){}}),new j({duration:50,name:"swapweapon",unit:Object(f.a)(o),onStart:function(t){return void 0!==t&&t!==o.currentWeapon},onStop:function(){},onComplete:function(t){o.currentWeapon=t}})],o}return Object(m.a)(e,t),Object(d.a)(e,[{key:"actionHandler",value:function(t,e,i){i.x+=this.dX*(t/1e3),i.y+=this.dZ*(t/1e3);var n=new u.ab(i.x-this.position.x,i.y-this.position.z).normalize(),o=+e.KeyW||0,a=+e.KeyS||0,s=+e.KeyA||0,r=+e.KeyD||0,c=e.KeyR,h=e.ButtonLeft,d=e.ShiftLeft,l=!e.ShiftLeft&&this.keyMap.ShiftLeft,p=[e.Digit1&&!this.keyMap.Digit1,e.Digit2&&!this.keyMap.Digit2,e.Digit3&&!this.keyMap.Digit3],f=!1,m=this.actions.find((function(t){return"run"===t.name})),v=this.currentWeapon.actions.find((function(t){return"shoot"===t.name})),y=this.currentWeapon.actions.find((function(t){return"reload"===t.name})),w=this.actions.find((function(t){return"swapweapon"===t.name}));if(this.energy=Number((this.energy+this.energyRegen*(t/1e3)).toFixed(2)),this.energy>this.maxEnergy&&(this.energy=this.maxEnergy),this.energy<0&&(this.energy=0),!f&&w&&p.includes(!0)){var g=this.weapons[p.indexOf(!0)];w.start(g),f=!0}if(!f&&c&&y&&(y.start(),f=!0),!f&&h&&v&&(v.start(n),f=!0),m&&this.currentAction===m&&(0===this.dX&&0===this.dZ||l||this.energy<=0)&&m.stop(),o>a)if(m&&!f&&d&&this.energy>10&&m.start(),s===r)this.dX=this.speed*n.x,this.dZ=this.speed*n.y;else{var x=n.clone();x.rotateAround(new u.ab(0,0),(r-s)*Math.PI/4),this.dX=this.speed*x.x,this.dZ=this.speed*x.y}else if(o<a)if(s===r)this.dX=-.5*this.speed*n.x,this.dZ=-.5*this.speed*n.y;else{var j=n.clone();j.rotateAround(new u.ab(0,0),-3*(s-r)*Math.PI/4),this.dX=.5*this.speed*j.x,this.dZ=.5*this.speed*j.y}else o===a&&(this.dX=this.dZ=0);m&&this.currentAction===m&&this.energy<0&&m.stop(),this.rotationAngle=Math.atan2(n.x,n.y),this.keyMap=Object(b.cloneDeep)(e)}},{key:"updateActions",value:function(t){var e=Object(c.a)(this.actions);e.push.apply(e,Object(c.a)(this.currentWeapon.actions)),e.forEach((function(e){return e.update(t)}))}}],[{key:"loadModel",value:function(t){var i=new v.a;i.load(e.modelPath,(function(n){n.animations=[];for(var o=function(o){i.load(e.animationsPath[o],(function(i){var a=i.animations;a[0].name=x(e.animationsPath[o]),n.animations.push(a[0]),n.animations.length===e.animationsPath.length&&t(n)}))},a=0;a<e.animationsPath.length;a++)o(a)}))}}]),e}(g);B.modelPath="textures/swat/model.fbx",B.animationsPath=["textures/swat/idle.fbx","textures/swat/walkforward.fbx","textures/swat/walkbackward.fbx","textures/swat/shoot.fbx","textures/swat/run.fbx","textures/swat/dying.fbx","textures/swat/hit.fbx"];var X=function(t){function e(t){var i;Object(h.a)(this,e);var n=new u.f(2*t.size,20,5),o=new u.D({color:16711680});return(i=Object(l.a)(this,Object(p.a)(e).call(this,n,o))).owner=void 0,i.owner=t,i.position.y=200,t.model.add(Object(f.a)(i)),i}return Object(m.a)(e,t),Object(d.a)(e,[{key:"update",value:function(t){if(this.owner.hp!==t&&this.material instanceof u.D){var e=Math.max(t/this.owner.maxHp,0);this.scale.set(e,1,1)}}}]),e}(u.C),N=function(t){function e(t,i,n,o){var a;return Object(h.a)(this,e),(a=Object(l.a)(this,Object(p.a)(e).call(this,t))).maxHp=void 0,a.hp=void 0,a.speed=void 0,a.hpRegen=void 0,a.options=void 0,a.target=void 0,a.options=o,a.position.x=i,a.position.z=n,a.maxHp=a.options.hp,a.hp=a.options.hp,a.speed=a.options.speed,a.hpRegen=a.options.hpRegen,a.actions=[new j({name:"attack",duration:o.attackDuration,unit:Object(f.a)(a),onStart:function(){return a.distanceToTraget()<a.options.attackRange},onStop:function(){},onComplete:function(t){if(a.distanceToTraget()<a.options.attackRange){t.hp-=a.options.damage;var e=t.animations.list.find((function(t){return"hit"===t.name}));e&&(e.reset(),e.play())}}})],a.target=a.world.player,a.hitBox=new X(Object(f.a)(a)),a}return Object(m.a)(e,t),Object(d.a)(e,[{key:"updateTarget",value:function(){this.target=this.world.player}},{key:"updateActions",value:function(t){this.actions.forEach((function(e){return e.update(t)}))}},{key:"actionHandler",value:function(t){var e=this.actions.find((function(t){return t.name="attack"}));if(this.target&&this.target.hp>0){var i=new u.ab(-this.position.x+this.target.position.x,-this.position.z+this.target.position.z).normalize();e&&this.distanceToTraget()<this.options.attackRange?(this.dX=this.dZ=0,e.start(this.target)):this.distanceToTraget()>this.options.spotDistance?(this.dX=0,this.dZ=0):(this.dX=this.speed*i.x,this.dZ=this.speed*i.y),this.rotationAngle=Math.atan2(i.x,i.y)}else this.dX=0,this.dZ=0}},{key:"distanceToTraget",value:function(){if(this.target){var t=new u.ab(this.position.x,this.position.z),e=new u.ab(this.target.position.x,this.target.position.z);return t.distanceTo(e)}return 1/0}}],[{key:"loadModel",value:function(t){var i=new v.a;i.load(e.modelPath,(function(n){n.animations=[];for(var o=function(o){i.load(e.animationsPath[o],(function(i){var a=i.animations;a[0].name=x(e.animationsPath[o]),n.animations.push(a[0]),n.animations.length===e.animationsPath.length&&t(n)}))},a=0;a<e.animationsPath.length;a++)o(a)}))}}]),e}(g);N.modelPath="textures/zombie/model.fbx",N.animationsPath=["textures/zombie/idle.fbx","textures/zombie/walkforward.fbx","textures/zombie/attack.fbx","textures/zombie/dying.fbx","textures/zombie/hit.fbx"];var T=i(14),q=function(){function t(){Object(h.a)(this,t)}return Object(d.a)(t,null,[{key:"spawnZombie",value:function(t,e){var i=K.getInstance(),n=i.models.zombie.animations,o=T.a.clone(i.models.zombie);o.animations=n,new N(o,t,e,{hp:500,speed:50,hpRegen:10,damage:200,attackRange:200,attackDuration:1100,spotDistance:1e3})}}]),t}(),W=1e4,H=500,F=200,K=function(){function t(e,i,n,o){var a=this;Object(h.a)(this,t),this.width=void 0,this.height=void 0,this.size=W,this.models=void 0,this.camera=void 0,this.player=void 0,this.spawnInterval=F,this.objects=void 0,this.quadtree=void 0,this.keyMap=void 0,this.mousePosition=void 0,this.ground=void 0,this.scene=void 0,t.instance=this,this.width=i,this.height=n,this.models=o,this.scene=e,this.camera=this.prepareCamera(),this.objects={units:[],projectiles:[]},this.quadtree=[],this.prepareMap(),this.spawnPlayer(0,0),this.keyMap={},this.mousePosition=new u.ab(0,W);var s=function(t){a.keyMap[t.code]="keydown"===t.type},r=s,c=document.getElementById("renderer");c&&(window.addEventListener("keydown",s),window.addEventListener("keyup",r),window.addEventListener("mousewheel",(function(t){if(t instanceof WheelEvent){var e=t.deltaY/-2e3;a.camera.zoom+e>=.5&&a.camera.zoom+e<=2&&(a.camera.zoom+=e,a.camera.updateProjectionMatrix())}})),window.addEventListener("contextmenu",(function(t){return t.preventDefault()})),c.addEventListener("mousedown",(function(t){0===t.button?a.keyMap.ButtonLeft=!0:2===t.button&&(a.keyMap.ButtonRight=!0)})),c.addEventListener("mouseup",(function(t){0===t.button?a.keyMap.ButtonLeft=!1:2===t.button&&(a.keyMap.ButtonRight=!1)})),c.addEventListener("mousemove",(function(t){var e=new u.ab;if(e.x=t.clientX/a.width*2-1,e.y=-t.clientY/a.height*2+1,a.ground){var i=new u.O;i.setFromCamera(e,a.camera);var n=i.intersectObjects([a.ground]);n.length&&n.forEach((function(t){t.object===a.ground&&(a.mousePosition.x=t.point.x,a.mousePosition.y=t.point.z)}))}})))}return Object(d.a)(t,[{key:"add",value:function(t){t instanceof g?(this.objects.units.push(t),this.scene.add(t.model)):t instanceof E?(this.objects.projectiles.push(t),this.scene.add(t)):this.scene.add(t)}},{key:"remove",value:function(t){t instanceof g?(this.dispose(t.model),this.objects.units=this.objects.units.filter((function(e){return e!==t})),t===this.player&&this.spawnPlayer(0,0)):(this.dispose(t),this.objects.projectiles=this.objects.projectiles.filter((function(e){return e!==t})))}},{key:"dispose",value:function(t){var e=this;this.scene.remove(t),t instanceof u.C&&(this.scene.remove(t),t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach((function(t){return t.dispose()})):t.material.dispose()),t.children&&t.children.forEach((function(t){return e.dispose(t)}))}},{key:"update",value:function(e){var i=this;if(this.spawnInterval<=0){if(this.spawnInterval=F,this.player&&this.objects.units.length<t.maxUnits){var n=Math.random()*Math.PI*2,o=W/15,a=this.player.position.x+Math.cos(n)*o,s=this.player.position.z+Math.sin(n)*o;q.spawnZombie(a,s)}}else this.spawnInterval-=e;this.player&&this.camera.position.set(-W/2+this.player.position.x,W/Math.sqrt(2)+this.player.position.y,-W/2+ +this.player.position.z),this.updateQuadTree(),this.objects.units.forEach((function(t){t.update(e,i.getNearObjects(t.quadtreeIndex),i.keyMap,i.mousePosition)})),this.objects.projectiles.forEach((function(t){t.update(e,i.getNearObjects(t.quadtreeIndex))}))}},{key:"spawnPlayer",value:function(t,e){var i=this;this.objects.units.forEach((function(t){t instanceof N&&(i.dispose(t.model),i.remove(t))})),this.player=void 0;var n=this.models.swat,o=new B(n,t,e);this.camera.position.set(-W/2,W/Math.sqrt(2),-W/2),this.camera.lookAt(n.position),this.player=o}},{key:"prepareCamera",value:function(){var t=new u.I(this.width/-2,this.width/2,this.height/2,this.height/-2,1,2*W);return t.position.set(-W/2,W/Math.sqrt(2),-W/2),t.zoom=.75,t.updateProjectionMatrix(),this.scene.add(t),t}},{key:"prepareMap",value:function(){var t,e=new u.K(16777215,1),i=new u.K(16777215,1),n=new u.K(16777215,1);e.position.set(-W/2,0,0),i.position.set(0,0,-W/2),n.position.set(0,W,0);var o=[e,i,n],a=this.models.background,s=this.models.background1;(t=this.scene).add.apply(t,[a,s].concat(o)),this.ground=s}},{key:"getNearObjects",value:function(t){if(!t)return[];for(var e=[],i=0;i<3;i++)for(var n=0;n<3;n++){var o,a=t-W/H-1+n+i*W/H;if(null===(o=this.quadtree[a])||void 0===o?void 0:o.length){var s=this.quadtree[a].filter((function(t){return t.hp>0}));e.push.apply(e,Object(c.a)(s))}}return e}},{key:"updateQuadTree",value:function(){var t=[];this.objects.units.forEach((function(e){var i=Math.ceil((W/2-e.position.z)/H)-1,n=Math.ceil((W/2-e.position.x)/H)-1,o=i*W/H+n;e.quadtreeIndex=o,t[o]?t[o].push(e):t[o]=[e]})),this.objects.projectiles.forEach((function(t){var e=Math.ceil((W/2-t.position.z)/H)-1,i=Math.ceil((W/2-t.position.x)/H)-1;t.quadtreeIndex=e*W/H+i})),this.quadtree=t}}],[{key:"getInstance",value:function(e){if(!t.instance){var i=e.scene,n=e.width,o=e.height,a=e.models;t.instance=new t(i,n,o,a)}return t.instance}}]),t}();K.SOUNDS_LEVEL=.2,K.instance=void 0,K.maxUnits=20;var V=function(t){var e=t.setState,i=Object(n.useState)({isLoaded:!1}),a=Object(r.a)(i,2),s=a[0],c=a[1],h=Object(n.useRef)(null);return Object(n.useEffect)((function(){!function(t){var e=new u.s(W,W/H,0,2236962);e.position.y=-5;var i=new u.C(new u.f(W,1,W),new u.D({color:"grey"}));i.position.y=-10,B.loadModel((function(n){N.loadModel((function(o){t({background:e,background1:i,swat:n,zombie:o,isLoaded:!0})}))}))}(c)}),[]),Object(n.useEffect)((function(){if(h.current&&s.isLoaded){var t=h.current,i=t.clientWidth,n=t.clientHeight,o=new u.fb({antialias:!0});o.setSize(i,n);var a=new u.Q;a.background=new u.j("white");var r=K.getInstance({scene:a,width:i,height:n,models:s});t.appendChild(o.domElement);!function t(i){var n=r.player,s=performance.now();document.hasFocus()&&(r.update(i),e({player:n})),window.requestAnimationFrame((function(){return t(performance.now()-s)})),o.render(a,r.camera)}(0),window.addEventListener("resize",(function(){return function(t){if(h.current){var e=K.getInstance(),i=h.current.clientWidth,n=h.current.clientHeight,o=e.camera;e.width=i,e.height=n,t.setSize(i,n),o.left=i/-2,o.right=i/2,o.top=n/2,o.bottom=n/-2,o.updateProjectionMatrix()}}(o)}))}}),[s]),s.isLoaded?o.a.createElement("div",{id:"renderer",className:"renderer",ref:h}):o.a.createElement("div",null,"Loading...")};var U=function(t){var e,i=t.state.player;return i instanceof B?o.a.createElement("div",{className:"hud"},o.a.createElement("div",{className:"energybar"},o.a.createElement("div",{className:"available",style:{width:"".concat(100*i.energy/i.maxEnergy,"%")}}),o.a.createElement("div",{className:"missing"})),o.a.createElement("div",{className:"healthbar"},o.a.createElement("div",{className:"available",style:{width:"".concat(Math.max(100*i.hp/i.maxHp,0),"%")}}),o.a.createElement("div",{className:"missing"})),o.a.createElement("div",{className:"weaponbar"},o.a.createElement("span",null,"".concat(i.currentWeapon.name," ").concat(i.currentWeapon.bullets,"/").concat(i.currentWeapon.maxBullets).concat("reload"===(null===(e=i.currentAction)||void 0===e?void 0:e.name)?" Reloading...":""))),o.a.createElement("div",{className:"optionsbar"},o.a.createElement("img",{src:"icons/sound.png",alt:"sound",className:"sound-icon"}),o.a.createElement("input",{type:"range",min:"0",max:"100",defaultValue:100*K.SOUNDS_LEVEL,className:"sound-slider",onChange:function(t){K.SOUNDS_LEVEL=Number(t.target.value)/100}}))):o.a.createElement(o.a.Fragment,null," ")};var _=function(){var t=Object(n.useState)({}),e=Object(r.a)(t,2),i=e[0],a=e[1];return o.a.createElement("div",{className:"app"},o.a.createElement(U,{state:i}),o.a.createElement(V,{setState:a}))};i(22),i(23);s.a.render(o.a.createElement(_,null),document.getElementById("root"))}},[[15,1,2]]]);
//# sourceMappingURL=main.29030df1.chunk.js.map